package github
import (
    "fmt"
    "log"
    "github.com/spf13/viper"
    yaml "gopkg.in/yaml.v2"
)

func (Configfile *Userinfo) UpdateUserinfo(id, idtoken, idrepo string) (*Userinfo){
    ConfigTemplate :="config"
    ConfigPath  :="src/github.com/zhangchl007/githubissuecli/config/"
    viper.SetConfigName(ConfigTemplate)
    viper.AddConfigPath(ConfigPath)
    err := viper.ReadInConfig()
    if err != nil {
        log.Fatal(err)
    }

    err = viper.Unmarshal(&Configfile)
    if err != nil{
       log.Fatalf("unable to decode into struct, %v", err)
    }
   viper.Set(Configfile.Userid, id)
   viper.Set(Configfile.PersonalAccessToken, idtoken)
   viper.Set(Configfile.Repo, idrepo)
   viper.WriteConfig()

   // encode yaml again
   d, err := yaml.Marshal(&Configfile)
   if err != nil {
      log.Fatalf("error: %v", err)
   }
   fmt.Println(string(d))
   return Configfile
}

